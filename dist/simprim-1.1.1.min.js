/*! SimPrim - Simple Image Trimming Library v1.1.1 | (c) Nfolio | ISC | https://github.com/Nfolio567/SimPrim */
!function(){"use strict";"undefined"!=typeof window&&(window.SimPrim=class{constructor(i){this.VERSION="1.1.1",this.scaleWidth=0,this.scaleHeight=0,this.resizing=!1,this.dragging=!1,this.isDragging=!1,this.decisionWH=!1,this.isAnimating=!1,this.defaultCursor=!0,this.drawTrimmingWidth=0,this.drawTrimmingHeight=0,this.inputCvs=i,this.inputCtx=this.inputCvs.getContext("2d")}init(i,s,t,h="https://cdn.nfolio.one/trimming.png"){var e;this.img=i;let o=0,n=0;this.cx=0,this.cy=0,this.dx=0,this.dy=0,this.beforeDx=0,this.beforeDy=0,this.resizable=!1,this.inputCvs.width=this.img.width,this.inputCvs.height=this.img.height,this.img.width<=this.img.height?(this.decisionWH=!1,this.inputCvs.style.cssText+="height:"+s+";width:"+t+";"):this.decisionWH=!0,o=this.inputCvs.width,n=this.inputCvs.height,null===(e=this.inputCtx)||void 0===e||e.drawImage(this.img,0,0,this.img.width,this.img.height,0,0,o,n);const d=new Image;d.crossOrigin="anonymous",this.trimming=d,this.decisionWH?(this.drawTrimmingHeight=this.inputCvs.height/3*2,this.drawTrimmingWidth=this.drawTrimmingHeight):(this.drawTrimmingWidth=this.inputCvs.width/3*2,this.drawTrimmingHeight=this.drawTrimmingWidth),this.trimming.onload=()=>{var i;this.trimming&&void 0!==this.dx&&void 0!==this.dy&&(null===(i=this.inputCtx)||void 0===i||i.drawImage(this.trimming,0,0,d.width,d.height,this.dx,this.dy,this.drawTrimmingWidth,this.drawTrimmingHeight))},this.trimming.src=h,this.inputCvs.addEventListener("mousemove",(()=>{this.defaultCursor&&(this.inputCvs.style.cursor="default")})),window.addEventListener("mouseup",(()=>{this.isDragging=!1,this.dragging=!1,this.resizing=!1}))}dragDetection(i){let s="";this.previewCvs=i;const t=null==i?void 0:i.getContext("2d");this.previewCvs&&t&&this.previewImg(this.previewCvs,t),this.inputCvs.addEventListener("mousedown",(()=>{this.isDragging=!0})),this.inputCvs.addEventListener("mousemove",(i=>{this.defaultCursor&&(this.inputCvs.style.cursor="default"),this.scaleWidth=this.inputCvs.width/this.inputCvs.clientWidth,this.scaleHeight=this.inputCvs.height/this.inputCvs.clientHeight,void 0!==this.dx&&(this.cx=this.dx/this.scaleWidth+this.drawTrimmingWidth/this.scaleWidth/2),void 0!==this.dy&&(this.cy=this.dy/this.scaleHeight+this.drawTrimmingHeight/this.scaleHeight/2),void 0!==this.cx&&void 0!==this.cy&&(i.offsetX>=this.cx-10&&i.offsetX<=this.cx+10&&i.offsetY>=this.cy-10&&i.offsetY<=this.cy+10?(this.inputCvs.style.cursor="move",this.defaultCursor=!1,this.isDragging&&(this.dragging=!0,this.isAnimating=!0)):this.defaultCursor=!0),void 0!==this.dx&&void 0!==this.dy&&(i.offsetX*this.scaleWidth>=this.dx-15&&i.offsetX*this.scaleWidth<=this.dx+15?(i.offsetY*this.scaleHeight>=this.dy-15&&i.offsetY*this.scaleHeight<=this.dy+15?(s="upL",this.resizing||(this.inputCvs.style.cursor="nwse-resize"),this.defaultCursor=!1,this.isDragging&&(this.resizing=!0,this.isAnimating=!0)):this.defaultCursor=!0,i.offsetY*this.scaleHeight>=this.dy+this.drawTrimmingHeight-15&&i.offsetY*this.scaleHeight<=this.dy+this.drawTrimmingHeight+15?(s="downL",this.resizing||(this.inputCvs.style.cursor="nesw-resize"),this.defaultCursor=!1,this.isDragging&&(this.resizing=!0,this.isAnimating=!0)):this.defaultCursor=!0):this.defaultCursor=!0,i.offsetX*this.scaleWidth>=this.dx+this.drawTrimmingWidth-15&&i.offsetX*this.scaleWidth<=this.dx+this.drawTrimmingWidth+15?(i.offsetY*this.scaleHeight>=this.dy-15&&i.offsetY*this.scaleHeight<=this.dy+15?(s="upR",this.resizing||(this.inputCvs.style.cursor="nesw-resize"),this.defaultCursor=!1,this.isDragging&&(this.resizing=!0,this.isAnimating=!0)):this.defaultCursor=!0,i.offsetY*this.scaleHeight>=this.dy+this.drawTrimmingHeight-15&&i.offsetY*this.scaleHeight<=this.dy+this.drawTrimmingHeight+15?(s="downR",this.resizing||(this.inputCvs.style.cursor="nwse-resize"),this.defaultCursor=!1,this.isDragging&&(this.resizing=!0,this.isAnimating=!0)):this.defaultCursor=!0):this.defaultCursor=!0),t&&this.requestFrame(t,i,s,"",0,0)}))}requestFrame(i,s,t,h,e,o){this.isAnimating&&(requestAnimationFrame((()=>{this.moveDrag(s),this.previewCvs&&i&&this.previewImg(this.previewCvs,i),this.resizable&&this.resizeDrag(s,t,h,e,o)})),this.dragging||this.resizing||(this.isAnimating=!1))}sizeChange(){this.resizable=!0}resizeDrag(i,s,t,h,e){t=s,function(i){var o,n,d,v,l;this.resizing&&void 0!==this.dx&&void 0!==this.dy&&((this.drawTrimmingWidth<=0||this.drawTrimmingHeight<=0)&&(this.drawTrimmingHeight=0,this.drawTrimmingWidth=this.drawTrimmingHeight),this.dragging=!1,s=t,this.isAnimating=!0,h=this.drawTrimmingWidth,e=this.drawTrimmingHeight,"downR"==s&&void 0!==this.img&&(this.inputCvs.style.cursor="nwse-resize",0!=i.movementX&&0==i.movementY&&(this.drawTrimmingWidth+=i.movementX*this.scaleWidth/2),0!=i.movementY&&0==i.movementX&&(this.drawTrimmingWidth+=i.movementY*this.scaleHeight/2),0!=i.movementX&&0!=i.movementY&&(this.drawTrimmingWidth+=i.movementX*this.scaleWidth/2,this.drawTrimmingWidth+=i.movementY*this.scaleHeight/2),this.drawTrimmingHeight=this.drawTrimmingWidth,this.dx+this.drawTrimmingWidth>=this.img.width&&(this.drawTrimmingWidth=this.img.width-this.dx,this.drawTrimmingHeight=this.drawTrimmingWidth),this.dy+this.drawTrimmingHeight>=this.img.height&&(this.drawTrimmingHeight=this.img.height-this.dy,this.drawTrimmingWidth=this.drawTrimmingHeight),null===(o=this.inputCtx)||void 0===o||o.drawImage(this.img,this.dx-1,this.dy-1,h+2,e+2,this.dx-1,this.dy-1,h+2,e+2)),"upR"==s&&this.img&&(this.beforeDy=this.dy,this.inputCvs.style.cursor="nesw-resize",0!=i.movementX&&0==i.movementY&&(this.dy-=i.movementX*this.scaleWidth/2,this.drawTrimmingWidth+=i.movementX*this.scaleWidth/2),0!=i.movementY&&0==i.movementX&&(this.dy+=i.movementY*this.scaleHeight/2,this.drawTrimmingWidth-=i.movementY*this.scaleHeight/2),0!=i.movementX&&0!=i.movementY&&(this.dy-=i.movementX*this.scaleWidth/2,this.dy+=i.movementY*this.scaleHeight/2,this.drawTrimmingWidth+=i.movementX*this.scaleWidth/2,this.drawTrimmingWidth-=i.movementY*this.scaleHeight/2),this.drawTrimmingHeight=this.drawTrimmingWidth,this.dx+this.drawTrimmingWidth>=this.img.width&&(this.drawTrimmingWidth=this.img.width-this.dx),this.dy<=0&&(this.dy=0,this.drawTrimmingHeight=e,this.drawTrimmingWidth=h),null===(n=this.inputCtx)||void 0===n||n.drawImage(this.img,this.dx-1,this.beforeDy-1,h+2,e+2,this.dx-1,this.beforeDy-1,h+2,e+2)),"downL"==s&&this.img&&(this.beforeDx=this.dx,this.inputCvs.style.cursor="nesw-resize",0!=i.movementX&&0==i.movementY&&(this.dx+=i.movementX*this.scaleWidth/2,this.drawTrimmingWidth-=i.movementX*this.scaleWidth/2),0!=i.movementY&&0==i.movementX&&(this.dx-=i.movementY*this.scaleHeight/2,this.drawTrimmingWidth+=i.movementY*this.scaleHeight/2),0!=i.movementX&&0!=i.movementY&&(this.dx+=i.movementX*this.scaleWidth/2,this.dx-=i.movementY*this.scaleHeight/2,this.drawTrimmingWidth-=i.movementX*this.scaleWidth/2,this.drawTrimmingWidth+=i.movementY*this.scaleHeight/2),this.drawTrimmingHeight=this.drawTrimmingWidth,this.dx<=0&&(this.dx=0,this.drawTrimmingWidth=h,this.drawTrimmingHeight=e),this.dy+this.drawTrimmingHeight>=this.img.height&&(this.drawTrimmingHeight=this.img.height-this.dy,this.drawTrimmingWidth=this.drawTrimmingHeight,this.dx=this.beforeDx),null===(d=this.inputCtx)||void 0===d||d.drawImage(this.img,this.beforeDx-1,this.dy-1,h+2,e+2,this.beforeDx-1,this.dy-1,h+2,e+2)),"upL"==s&&(this.beforeDx=this.dx,this.beforeDy=this.dy,this.inputCvs.style.cursor="nwse-resize",0!=i.movementX&&0==i.movementY&&(this.dx+=i.movementX*this.scaleWidth/2,this.dy+=i.movementX*this.scaleWidth/2,this.drawTrimmingWidth-=i.movementX*this.scaleWidth/2),0!=i.movementY&&0==i.movementX&&(this.dx+=i.movementY*this.scaleHeight/2,this.dy+=i.movementY*this.scaleHeight/2,this.drawTrimmingWidth-=i.movementY*this.scaleHeight/2),0!=i.movementX&&0!=i.movementY&&(this.dx+=i.movementX*this.scaleWidth/2,this.dy+=i.movementX*this.scaleWidth/2,this.dx+=i.movementY*this.scaleHeight/2,this.dy+=i.movementY*this.scaleHeight/2,this.drawTrimmingWidth-=i.movementX*this.scaleWidth/2,this.drawTrimmingWidth-=i.movementY*this.scaleHeight/2),this.drawTrimmingHeight=this.drawTrimmingWidth,this.dx<=0&&(this.dx=0,this.dy=this.beforeDy,this.drawTrimmingWidth=h,this.drawTrimmingHeight=e),this.dy<=0&&(this.dy=0,this.dx=this.beforeDx,this.drawTrimmingWidth=h,this.drawTrimmingHeight=e),this.img&&(null===(v=this.inputCtx)||void 0===v||v.drawImage(this.img,this.beforeDx-1,this.beforeDy-1,h+2,e+2,this.beforeDx-1,this.beforeDy-1,h+2,e+2))),this.trimming&&(null===(l=this.inputCtx)||void 0===l||l.drawImage(this.trimming,0,0,this.trimming.width,this.trimming.height,this.dx,this.dy,this.drawTrimmingWidth,this.drawTrimmingHeight)))}.call(this,i)}previewImg(i,s){null==s||s.clearRect(0,0,i.width,i.height),this.img&&void 0!==this.dx&&void 0!==this.dy&&(null==s||s.drawImage(this.img,this.dx,this.dy,this.drawTrimmingWidth,this.drawTrimmingHeight,0,0,i.width,i.height))}moveDrag(i){var s,t;this.dragging&&(this.inputCvs.style.cursor="move",void 0!==this.dx&&(this.beforeDx=this.dx),void 0!==this.dy&&(this.beforeDy=this.dy),this.dx=(i.offsetX-this.drawTrimmingWidth/this.scaleWidth/2)*this.scaleWidth,this.dy=(i.offsetY-this.drawTrimmingHeight/this.scaleHeight/2)*this.scaleHeight,this.trimming&&this.img&&(this.dx<=0&&(this.dx=0),this.dy<=0&&(this.dy=0),this.dx+this.drawTrimmingWidth>=this.img.width&&(this.dx=this.img.width-this.drawTrimmingWidth),this.dy+this.drawTrimmingHeight>=this.img.height&&(this.dy=this.img.height-this.drawTrimmingHeight)),this.img&&this.trimming&&void 0!==this.dx&&void 0!==this.dy&&void 0!==this.beforeDx&&void 0!==this.beforeDy&&(null===(s=this.inputCtx)||void 0===s||s.drawImage(this.img,this.beforeDx-1,this.beforeDy-1,this.drawTrimmingWidth+2,this.drawTrimmingHeight+2,this.beforeDx-1,this.beforeDy-1,this.drawTrimmingWidth+2,this.drawTrimmingHeight+2),null===(t=this.inputCtx)||void 0===t||t.drawImage(this.trimming,0,0,this.trimming.width,this.trimming.height,this.dx,this.dy,this.drawTrimmingWidth,this.drawTrimmingHeight)))}exportImg(i){var s;let t=i.getContext("2d"),h=null===(s=this.previewCvs)||void 0===s?void 0:s.toDataURL(),e=new Image;e.onload=()=>{h&&(null==t||t.drawImage(e,0,0))},h&&(e.src=h)}})}();
