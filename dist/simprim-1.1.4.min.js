/*! SimPrim - Simple Image Trimming Library v1.1.1 | (c) Nfolio | ISC | https://github.com/Nfolio567/SimPrim */
!function(){"use strict";"undefined"!=typeof window&&(window.SimPrim=class{constructor(){this.VERSION="1.1.3",this.resizing=!1,this.areaMoving=!1,this.isDragging=!1,this.decisionWH=!1,this.isAnimating=!1,this.isAnimatingOK=!1,this.defaultCursor=!0,this.drawTrimmingWidth=0,this.drawTrimmingHeight=0}init(i,s,t,h,o="https://cdn.nfolio.one/trimming.png"){var e;void 0!==this.animationFrameID&&(cancelAnimationFrame(this.animationFrameID),this.animationFrameID=void 0),this.inputCvs=i,this.inputCtx=this.inputCvs.getContext("2d"),this.img=s;let n=0,d=0;this.cx=0,this.cy=0,this.dx=0,this.dy=0,this.beforeDx=0,this.beforeDy=0,this.resizable=!1,this.inputCvs.width=this.img.width,this.inputCvs.height=this.img.height,this.img.width<=this.img.height?(this.decisionWH=!1,this.inputCvs.style.cssText+="height:"+t+";width:"+h+";"):this.decisionWH=!0,n=this.inputCvs.width,d=this.inputCvs.height,null===(e=this.inputCtx)||void 0===e||e.drawImage(this.img,0,0,this.img.width,this.img.height,0,0,n,d);const v=new Image;v.crossOrigin="anonymous",this.trimming=v,this.decisionWH?(this.drawTrimmingHeight=this.inputCvs.height/3*2,this.drawTrimmingWidth=this.drawTrimmingHeight):(this.drawTrimmingWidth=this.inputCvs.width/3*2,this.drawTrimmingHeight=this.drawTrimmingWidth),this.trimming.onload=()=>{var i;this.trimming&&void 0!==this.dx&&void 0!==this.dy&&(null===(i=this.inputCtx)||void 0===i||i.drawImage(this.trimming,0,0,v.width,v.height,this.dx,this.dy,this.drawTrimmingWidth,this.drawTrimmingHeight))},this.trimming.src=o,window.addEventListener("mouseup",(()=>{this.isDragging=!1,this.areaMoving=!1,this.resizing=!1}))}dragDetection(i){var s,t;let h="";this.deltaX=0,this.deltaY=0,this.previewCvs=i;const o=null==i?void 0:i.getContext("2d");this.previewCvs&&o&&this.previewImg(this.previewCvs,o),null===(s=this.inputCvs)||void 0===s||s.addEventListener("mousedown",(()=>{this.isDragging=!0})),null===(t=this.inputCvs)||void 0===t||t.addEventListener("mousemove",(i=>{o&&this.isDragging&&this.requestFrame(o,i,h,"",0,0),this.defaultCursor&&this.inputCvs&&(this.inputCvs.style.cursor="default"),void 0!==this.dx&&(this.cx=this.dx/this.scaleWidth()+this.drawTrimmingWidth/this.scaleWidth()/2),void 0!==this.dy&&(this.cy=this.dy/this.scaleHeight()+this.drawTrimmingHeight/this.scaleHeight()/2),void 0!==this.cx&&void 0!==this.cy&&(i.offsetX>=this.cx-10&&i.offsetX<=this.cx+10&&i.offsetY>=this.cy-10&&i.offsetY<=this.cy+10?(this.defaultCursor=!1,this.inputCvs&&(this.inputCvs.style.cursor="move"),this.isDragging&&(this.areaMoving=!0,this.isAnimatingOK=!0)):this.isDragging||(this.defaultCursor=!0)),void 0!==this.dx&&void 0!==this.dy&&(i.offsetX*this.scaleWidth()>=this.dx-15&&i.offsetX*this.scaleWidth()<=this.dx+15?(i.offsetY*this.scaleHeight()>=this.dy-15&&i.offsetY*this.scaleHeight()<=this.dy+15?(h="upL",this.defaultCursor=!1,!this.resizing&&this.inputCvs&&(this.inputCvs.style.cursor="nwse-resize"),this.isDragging&&(this.resizing=!0,this.isAnimatingOK=!0)):this.isDragging||(this.defaultCursor=!0),i.offsetY*this.scaleHeight()>=this.dy+this.drawTrimmingHeight-15&&i.offsetY*this.scaleHeight()<=this.dy+this.drawTrimmingHeight+15?(h="downL",this.defaultCursor=!1,!this.resizing&&this.inputCvs&&(this.inputCvs.style.cursor="nesw-resize"),this.isDragging&&(this.resizing=!0,this.isAnimatingOK=!0)):this.isDragging||(this.defaultCursor=!0)):this.isDragging||(this.defaultCursor=!0),i.offsetX*this.scaleWidth()>=this.dx+this.drawTrimmingWidth-15&&i.offsetX*this.scaleWidth()<=this.dx+this.drawTrimmingWidth+15?(i.offsetY*this.scaleHeight()>=this.dy-15&&i.offsetY*this.scaleHeight()<=this.dy+15?(h="upR",this.defaultCursor=!1,!this.resizing&&this.inputCvs&&(this.inputCvs.style.cursor="nesw-resize"),this.isDragging&&(this.resizing=!0,this.isAnimatingOK=!0)):this.isDragging||(this.defaultCursor=!0),i.offsetY*this.scaleHeight()>=this.dy+this.drawTrimmingHeight-15&&i.offsetY*this.scaleHeight()<=this.dy+this.drawTrimmingHeight+15?(h="downR",this.defaultCursor=!1,!this.resizing&&this.inputCvs&&(this.inputCvs.style.cursor="nwse-resize"),this.isDragging&&(this.resizing=!0,this.isAnimatingOK=!0)):this.isDragging||(this.defaultCursor=!0)):this.isDragging||(this.defaultCursor=!0)),this.areaMoving||this.resizing||(this.isAnimatingOK=!1)}))}requestFrame(i,s,t,h,o,e){this.isAnimatingOK&&(this.isAnimating||(this.isAnimating=!0,this.animationFrameID=requestAnimationFrame((()=>{this.areaMoving&&this.moveDrag(s),this.resizable&&this.resizing&&this.resizeDrag(s,t,h,o,e),this.previewCvs&&i&&this.previewImg(this.previewCvs,i),this.isAnimating=!1}))))}sizeChange(){this.resizable=!0}resizeDrag(i,s,t,h,o){t=s,function(i){var e,n,d,v,l;if(this.resizing&&void 0!==this.dx&&void 0!==this.dy&&void 0!==this.deltaX&&void 0!==this.deltaY){let r=i.clientX-this.deltaX,u=i.clientY-this.deltaY;this.deltaX=i.clientX,this.deltaY=i.clientY,r==i.clientX&&(r=0),u==i.clientY&&(u=0),0==r&&i.movementX>0&&(r=1),0==r&&i.movementX<0&&(r=-1),0==u&&i.movementY>0&&(u=1),0==u&&i.movementY<0&&(u=-1),/Safari/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)||(r=i.movementX,u=i.movementY),(this.drawTrimmingWidth<=0||this.drawTrimmingHeight<=0)&&(this.drawTrimmingHeight=0,this.drawTrimmingWidth=this.drawTrimmingHeight),this.areaMoving=!1,s=t,this.isAnimatingOK=!0,h=this.drawTrimmingWidth,o=this.drawTrimmingHeight,"downR"==s&&void 0!==this.img&&this.inputCvs&&(this.inputCvs.style.cursor="nwse-resize",0!==i.movementX&&0===i.movementY&&(this.drawTrimmingWidth+=r*this.scaleWidth()/2),0!==i.movementY&&0===i.movementX&&(this.drawTrimmingWidth+=u*this.scaleHeight()/2),0!==i.movementX&&0!==i.movementY&&(this.drawTrimmingWidth+=r*this.scaleWidth()/2,this.drawTrimmingWidth+=u*this.scaleHeight()/2),this.drawTrimmingHeight=this.drawTrimmingWidth,this.dx+this.drawTrimmingWidth>=this.img.width&&(this.drawTrimmingWidth=this.img.width-this.dx,this.drawTrimmingHeight=this.drawTrimmingWidth),this.dy+this.drawTrimmingHeight>=this.img.height&&(this.drawTrimmingHeight=this.img.height-this.dy,this.drawTrimmingWidth=this.drawTrimmingHeight),null===(e=this.inputCtx)||void 0===e||e.drawImage(this.img,this.dx-1,this.dy-1,h+2,o+2,this.dx-1,this.dy-1,h+2,o+2)),"upR"==s&&this.img&&this.inputCvs&&(this.beforeDy=this.dy,this.inputCvs.style.cursor="nesw-resize",0!=i.movementX&&0==i.movementY&&(this.dy-=i.movementX*this.scaleWidth()/2,this.drawTrimmingWidth+=i.movementX*this.scaleWidth()/2),0!=i.movementY&&0==i.movementX&&(this.dy+=i.movementY*this.scaleHeight()/2,this.drawTrimmingWidth-=i.movementY*this.scaleHeight()/2),0!=i.movementX&&0!=i.movementY&&(this.dy-=i.movementX*this.scaleWidth()/2,this.dy+=i.movementY*this.scaleHeight()/2,this.drawTrimmingWidth+=i.movementX*this.scaleWidth()/2,this.drawTrimmingWidth-=i.movementY*this.scaleHeight()/2),this.drawTrimmingHeight=this.drawTrimmingWidth,this.dx+this.drawTrimmingWidth>=this.img.width&&(this.drawTrimmingWidth=this.img.width-this.dx),this.dy<=0&&(this.dy=0,this.drawTrimmingHeight=o,this.drawTrimmingWidth=h),null===(n=this.inputCtx)||void 0===n||n.drawImage(this.img,this.dx-1,this.beforeDy-1,h+2,o+2,this.dx-1,this.beforeDy-1,h+2,o+2)),"downL"==s&&this.img&&this.inputCvs&&(this.beforeDx=this.dx,this.inputCvs.style.cursor="nesw-resize",0!=i.movementX&&0==i.movementY&&(this.dx+=i.movementX*this.scaleWidth()/2,this.drawTrimmingWidth-=i.movementX*this.scaleWidth()/2),0!=i.movementY&&0==i.movementX&&(this.dx-=i.movementY*this.scaleHeight()/2,this.drawTrimmingWidth+=i.movementY*this.scaleHeight()/2),0!=i.movementX&&0!=i.movementY&&(this.dx+=i.movementX*this.scaleWidth()/2,this.dx-=i.movementY*this.scaleHeight()/2,this.drawTrimmingWidth-=i.movementX*this.scaleWidth()/2,this.drawTrimmingWidth+=i.movementY*this.scaleHeight()/2),this.drawTrimmingHeight=this.drawTrimmingWidth,this.dx<=0&&(this.dx=0,this.drawTrimmingWidth=h,this.drawTrimmingHeight=o),this.dy+this.drawTrimmingHeight>=this.img.height&&(this.drawTrimmingHeight=this.img.height-this.dy,this.drawTrimmingWidth=this.drawTrimmingHeight,this.dx=this.beforeDx),null===(d=this.inputCtx)||void 0===d||d.drawImage(this.img,this.beforeDx-1,this.dy-1,h+2,o+2,this.beforeDx-1,this.dy-1,h+2,o+2)),"upL"==s&&this.img&&this.inputCvs&&(this.beforeDx=this.dx,this.beforeDy=this.dy,this.inputCvs.style.cursor="nwse-resize",0!=i.movementX&&0==i.movementY&&(this.dx+=i.movementX*this.scaleWidth()/2,this.dy+=i.movementX*this.scaleWidth()/2,this.drawTrimmingWidth-=i.movementX*this.scaleWidth()/2),0!=i.movementY&&0==i.movementX&&(this.dx+=i.movementY*this.scaleHeight()/2,this.dy+=i.movementY*this.scaleHeight()/2,this.drawTrimmingWidth-=i.movementY*this.scaleHeight()/2),0!=i.movementX&&0!=i.movementY&&(this.dx+=i.movementX*this.scaleWidth()/2,this.dy+=i.movementX*this.scaleWidth()/2,this.dx+=i.movementY*this.scaleHeight()/2,this.dy+=i.movementY*this.scaleHeight()/2,this.drawTrimmingWidth-=i.movementX*this.scaleWidth()/2,this.drawTrimmingWidth-=i.movementY*this.scaleHeight()/2),this.drawTrimmingHeight=this.drawTrimmingWidth,this.dx<=0&&(this.dx=0,this.dy=this.beforeDy,this.drawTrimmingWidth=h,this.drawTrimmingHeight=o),this.dy<=0&&(this.dy=0,this.dx=this.beforeDx,this.drawTrimmingWidth=h,this.drawTrimmingHeight=o),null===(v=this.inputCtx)||void 0===v||v.drawImage(this.img,this.beforeDx-1,this.beforeDy-1,h+2,o+2,this.beforeDx-1,this.beforeDy-1,h+2,o+2)),this.trimming&&(null===(l=this.inputCtx)||void 0===l||l.drawImage(this.trimming,0,0,this.trimming.width,this.trimming.height,this.dx,this.dy,this.drawTrimmingWidth,this.drawTrimmingHeight))}}.call(this,i)}scaleWidth(){return this.inputCvs?this.inputCvs.width/this.inputCvs.clientWidth:1}scaleHeight(){return this.inputCvs?this.inputCvs.height/this.inputCvs.clientHeight:1}previewImg(i,s){null==s||s.clearRect(0,0,i.width,i.height),this.img&&void 0!==this.dx&&void 0!==this.dy&&(null==s||s.drawImage(this.img,this.dx,this.dy,this.drawTrimmingWidth,this.drawTrimmingHeight,0,0,i.width,i.height))}moveDrag(i){var s,t;this.areaMoving&&this.inputCvs&&(this.inputCvs.style.cursor="move",void 0!==this.dx&&(this.beforeDx=this.dx),void 0!==this.dy&&(this.beforeDy=this.dy),this.dx=(i.offsetX-this.drawTrimmingWidth/this.scaleWidth()/2)*this.scaleWidth(),this.dy=(i.offsetY-this.drawTrimmingHeight/this.scaleHeight()/2)*this.scaleHeight(),this.trimming&&this.img&&(this.dx<=0&&(this.dx=0),this.dy<=0&&(this.dy=0),this.dx+this.drawTrimmingWidth>=this.img.width&&(this.dx=this.img.width-this.drawTrimmingWidth),this.dy+this.drawTrimmingHeight>=this.img.height&&(this.dy=this.img.height-this.drawTrimmingHeight)),this.img&&this.trimming&&void 0!==this.dx&&void 0!==this.dy&&void 0!==this.beforeDx&&void 0!==this.beforeDy&&(null===(s=this.inputCtx)||void 0===s||s.drawImage(this.img,this.beforeDx-1,this.beforeDy-1,this.drawTrimmingWidth+2,this.drawTrimmingHeight+2,this.beforeDx-1,this.beforeDy-1,this.drawTrimmingWidth+2,this.drawTrimmingHeight+2),null===(t=this.inputCtx)||void 0===t||t.drawImage(this.trimming,0,0,this.trimming.width,this.trimming.height,this.dx,this.dy,this.drawTrimmingWidth,this.drawTrimmingHeight)))}exportImg(i){var s;const t=i.getContext("2d"),h=null===(s=this.previewCvs)||void 0===s?void 0:s.toDataURL(),o=new Image;o.onload=()=>{h&&(null==t||t.drawImage(o,0,0))},h&&(o.src=h)}})}();
