!function(){"use strict";"undefined"!=typeof window&&(window.SimPrim=class{constructor(i){this.scaleWidth=0,this.scaleHeight=0,this.resizing=!1,this.dragging=!1,this.isDragging=!1,this.decisionWH=!1,this.isAnimating=!1,this.defaultCursor=!0,this.drawTrimmingWidth=0,this.drawTrimmingHeight=0,this.inputCvs=i,this.inputCtx=this.inputCvs.getContext("2d")}init(i,s,t,h="https://cdn.nfolio.one/trimming.png"){var e;this.img=i;let o=0,n=0;this.cx=0,this.cy=0,this.dx=0,this.dy=0,this.beforeDx=0,this.beforeDy=0,this.inputCvs.width=this.img.width,this.inputCvs.height=this.img.height,this.img.width<=this.img.height?(this.decisionWH=!1,this.inputCvs.style.cssText+="height:"+s+";width:"+t+";"):this.decisionWH=!0,o=this.inputCvs.width,n=this.inputCvs.height,null===(e=this.inputCtx)||void 0===e||e.drawImage(this.img,0,0,this.img.width,this.img.height,0,0,o,n);const d=new Image;d.crossOrigin="anonymous",this.trimming=d,this.decisionWH?(this.drawTrimmingHeight=this.inputCvs.height/3*2,this.drawTrimmingWidth=this.drawTrimmingHeight):(this.drawTrimmingWidth=this.inputCvs.width/3*2,this.drawTrimmingHeight=this.drawTrimmingWidth),this.trimming.onload=()=>{var i;this.trimming&&void 0!==this.dx&&void 0!==this.dy&&(null===(i=this.inputCtx)||void 0===i||i.drawImage(this.trimming,0,0,d.width,d.height,this.dx,this.dy,this.drawTrimmingWidth,this.drawTrimmingHeight))},this.trimming.src=h,this.inputCvs.addEventListener("mousemove",(()=>{this.defaultCursor&&(this.inputCvs.style.cursor="default")})),window.addEventListener("mouseup",(()=>{this.isDragging=!1,this.dragging=!1,this.resizing=!1}))}dragDetection(i){i&&this.previewImg(i),this.inputCvs.addEventListener("mousedown",(()=>{this.isDragging=!0})),this.inputCvs.addEventListener("mousemove",(s=>{this.defaultCursor&&(this.inputCvs.style.cursor="default"),this.scaleWidth=this.inputCvs.width/this.inputCvs.clientWidth,this.scaleHeight=this.inputCvs.height/this.inputCvs.clientHeight,void 0!==this.dx&&(this.cx=this.dx/this.scaleWidth+this.drawTrimmingWidth/this.scaleWidth/2),void 0!==this.dy&&(this.cy=this.dy/this.scaleHeight+this.drawTrimmingHeight/this.scaleHeight/2),void 0!==this.cx&&void 0!==this.cy&&(s.offsetX>=this.cx-10&&s.offsetX<=this.cx+10&&s.offsetY>=this.cy-10&&s.offsetY<=this.cy+10?(this.inputCvs.style.cursor="move",this.defaultCursor=!1,this.isDragging&&(this.dragging=!0,this.isAnimating=!0)):this.defaultCursor=!0),void 0!==i&&this.requestFrame(i,s)}))}requestFrame(i,s){this.isAnimating&&(requestAnimationFrame((()=>{var t,h;this.dragging&&(this.inputCvs.style.cursor="move",void 0!==this.dx&&(this.beforeDx=this.dx),void 0!==this.dy&&(this.beforeDy=this.dy),this.dx=(s.offsetX-this.drawTrimmingWidth/this.scaleWidth/2)*this.scaleWidth,this.dy=(s.offsetY-this.drawTrimmingHeight/this.scaleHeight/2)*this.scaleHeight,this.trimming&&this.img&&(this.dx<=0&&(this.dx=0),this.dy<=0&&(this.dy=0),this.dx+this.drawTrimmingWidth>=this.img.width&&(this.dx=this.img.width-this.drawTrimmingWidth),this.dy+this.drawTrimmingHeight>=this.img.height&&(this.dy=this.img.height-this.drawTrimmingHeight)),this.img&&this.trimming&&void 0!==this.dx&&void 0!==this.dy&&void 0!==this.beforeDx&&void 0!==this.beforeDy&&(null===(t=this.inputCtx)||void 0===t||t.drawImage(this.img,this.beforeDx-1,this.beforeDy-1,this.drawTrimmingWidth+2,this.drawTrimmingHeight+2,this.beforeDx-1,this.beforeDy-1,this.drawTrimmingWidth+2,this.drawTrimmingHeight+2),null===(h=this.inputCtx)||void 0===h||h.drawImage(this.trimming,0,0,this.trimming.width,this.trimming.height,this.dx,this.dy,this.drawTrimmingWidth,this.drawTrimmingHeight))),i&&this.previewImg(i)})),this.dragging||this.resizing||(this.isAnimating=!1))}sizeChange(){let i="",s=0,t=0;this.inputCvs.addEventListener("mousemove",(h=>{var e,o,n,d,v;void 0!==this.dx&&void 0!==this.dy&&(h.offsetX*this.scaleWidth>=this.dx-15&&h.offsetX*this.scaleWidth<=this.dx+15?(h.offsetY*this.scaleHeight>=this.dy-15&&h.offsetY*this.scaleHeight<=this.dy+15?(i="upL",this.inputCvs.style.cursor="nwse-resize",this.defaultCursor=!1,this.isDragging&&(this.resizing=!0)):this.defaultCursor=!0,h.offsetY*this.scaleHeight>=this.dy+this.drawTrimmingHeight-15&&h.offsetY*this.scaleHeight<=this.dy+this.drawTrimmingHeight+15?(i="downL",this.inputCvs.style.cursor="nesw-resize",this.defaultCursor=!1,this.isDragging&&(this.resizing=!0)):this.defaultCursor=!0):this.defaultCursor=!0,h.offsetX*this.scaleWidth>=this.dx+this.drawTrimmingWidth-15&&h.offsetX*this.scaleWidth<=this.dx+this.drawTrimmingWidth+15?(h.offsetY*this.scaleHeight>=this.dy-15&&h.offsetY*this.scaleHeight<=this.dy+15?(i="upR",this.inputCvs.style.cursor="nesw-resize",this.defaultCursor=!1,this.isDragging&&(this.resizing=!0)):this.defaultCursor=!0,h.offsetY*this.scaleHeight>=this.dy+this.drawTrimmingHeight-15&&h.offsetY*this.scaleHeight<=this.dy+this.drawTrimmingHeight+15?(i="downR",this.inputCvs.style.cursor="nwse-resize",this.defaultCursor=!1,this.isDragging&&(this.resizing=!0)):this.defaultCursor=!0):this.defaultCursor=!0,this.resizing&&(this.isAnimating=!0,s=this.drawTrimmingWidth,t=this.drawTrimmingHeight,"downR"==i&&this.img&&(this.inputCvs.style.cursor="nwse-resize",0!=h.movementX&&(this.drawTrimmingWidth+=h.movementX*this.scaleWidth),0!=h.movementY&&(this.drawTrimmingHeight+=h.movementY*this.scaleHeight),0!=h.movementX&&0!=h.movementY&&(this.drawTrimmingWidth+=h.movementX/this.scaleWidth/4*2-h.movementX/this.scaleWidth/2,this.drawTrimmingHeight+=h.movementY/this.scaleHeight/4*2-h.movementX/this.scaleHeight/2),this.drawTrimmingHeight=this.drawTrimmingWidth,this.dx+this.drawTrimmingWidth>=this.img.width&&(this.drawTrimmingWidth=this.img.width-this.dx,this.drawTrimmingHeight=this.drawTrimmingWidth),this.dy+this.drawTrimmingHeight>=this.img.height&&(this.drawTrimmingHeight=this.img.height-this.dy,this.drawTrimmingWidth=this.drawTrimmingHeight),null===(e=this.inputCtx)||void 0===e||e.drawImage(this.img,this.dx-1,this.dy-1,s+2,t+2,this.dx-1,this.dy-1,s+2,t+2)),"upR"==i&&this.img&&(this.beforeDy=this.dy,this.inputCvs.style.cursor="nesw-resize",0!=h.movementX&&(this.dy-=h.movementX*this.scaleWidth,this.drawTrimmingWidth+=h.movementX*this.scaleWidth),this.drawTrimmingHeight=this.drawTrimmingWidth,this.dx+this.drawTrimmingWidth>=this.img.width&&(this.drawTrimmingWidth=this.img.width-this.dx),this.dy<=0&&(this.dy=0,this.drawTrimmingHeight=t,this.drawTrimmingWidth=s),null===(o=this.inputCtx)||void 0===o||o.drawImage(this.img,this.dx-1,this.beforeDy-1,s+2,t+2,this.dx-1,this.beforeDy-1,s+2,t+2)),"downL"==i&&this.img&&(this.beforeDx=this.dx,this.inputCvs.style.cursor="nesw-resize",0!=h.movementX&&(this.dx+=h.movementX*this.scaleWidth,this.drawTrimmingWidth-=h.movementX*this.scaleWidth),this.drawTrimmingHeight=this.drawTrimmingWidth,this.dx<=0&&(this.dx=0,this.drawTrimmingWidth=s,this.drawTrimmingHeight=t),this.dy+this.drawTrimmingHeight>=this.img.height&&(this.drawTrimmingHeight=this.img.height-this.dy,this.drawTrimmingWidth=this.drawTrimmingHeight,this.dx=this.beforeDx),null===(n=this.inputCtx)||void 0===n||n.drawImage(this.img,this.beforeDx-1,this.dy-1,s+2,t+2,this.beforeDx-1,this.dy-1,s+2,t+2)),"upL"==i&&(this.beforeDx=this.dx,this.beforeDy=this.dy,this.inputCvs.style.cursor="nwse-resize",0!=h.movementX&&(this.dx+=h.movementX*this.scaleWidth,this.dy+=h.movementX*this.scaleWidth,this.drawTrimmingWidth-=h.movementX*this.scaleWidth),this.drawTrimmingHeight=this.drawTrimmingWidth,this.dx<=0&&(this.dx=0,this.dy=this.beforeDy,this.drawTrimmingWidth=s,this.drawTrimmingHeight=t),this.dy<=0&&(this.dy=0,this.dx=this.beforeDx,this.drawTrimmingWidth=s,this.drawTrimmingHeight=t),this.img&&(null===(d=this.inputCtx)||void 0===d||d.drawImage(this.img,this.beforeDx-1,this.beforeDy-1,s+2,t+2,this.beforeDx-1,this.beforeDy-1,s+2,t+2))),this.trimming&&(null===(v=this.inputCtx)||void 0===v||v.drawImage(this.trimming,0,0,this.trimming.width,this.trimming.height,this.dx,this.dy,this.drawTrimmingWidth,this.drawTrimmingHeight))))}))}previewImg(i){this.previewCvs=i;const s=this.previewCvs.getContext("2d");null==s||s.clearRect(0,0,i.width,i.height),this.img&&void 0!==this.dx&&void 0!==this.dy&&(null==s||s.drawImage(this.img,this.dx,this.dy,this.drawTrimmingWidth,this.drawTrimmingHeight,0,0,i.width,i.height))}exportImg(i){var s;let t=i.getContext("2d"),h=null===(s=this.previewCvs)||void 0===s?void 0:s.toDataURL(),e=new Image;e.onload=()=>{h&&(null==t||t.drawImage(e,0,0))},h&&(e.src=h)}})}();
